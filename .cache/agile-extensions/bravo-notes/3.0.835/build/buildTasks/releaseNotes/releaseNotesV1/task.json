{
    "id": "661b3a30-5352-494c-bb65-8bad1aea86de",
    "name": "releaseNotes",
    "friendlyName": "Compile release notes",
    "description": "Compile release notes",
    "author": "Agile Extensions",
    "category": "Utility",
    "visibility": ["Build", "Release"],
    "version": {
        "Major": 2,
        "Minor": 8,
        "Patch": 0
    },
    "minimumAgentVersion": "1.82.0",
    "instanceNameFormat": "Compile Release Notes",
    "groups": [
        {
            "name": "advanced",
            "displayName": "Advanced",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "connection",
            "type": "connectedService:extension-data-endpoint",
            "label": "Bravo Notes Connection",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Bravo Notes service connection"
        },
        {
            "name": "notes",
            "type": "pickList",
            "label": "Notes",
            "defaultValue": "",
            "required": true,
            "properties": {
                "EditableOptions": "True"
            },
            "helpMarkDown": "Bravo Notes document"
        },
        {
            "name": "outputFormat",
            "type": "pickList",
            "label": "Output format",
            "defaultValue": "Markdown",
            "required": true,
            "options": {
                "md": "Markdown",
                "html": "HTML",
                "pdf": "PDF"
            },
            "helpMarkDown": "Format of the rendered document"
        },
        {
            "name": "outputTarget",
            "type": "pickList",
            "label": "Output target",
            "defaultValue": "File",
            "required": true,
            "options": {
                "File": "File",
                "Wiki": "Wiki"
            },
            "helpMarkDown": "Target to store the rendered document"
        },
        {
            "name": "outputFilePath",
            "type": "string",
            "label": "Output file path",
            "defaultValue": "",
            "required": true,
            "visibleRule": "outputTarget = File",
            "helpMarkDown":
                "Path to write rendered notes to e.g. $(Build.ArtifactStagingDirectory)\\releasenotes.pdf"
        },
        {
            "name": "targetWiki",
            "type": "pickList",
            "label": "Target Wiki",
            "defaultValue": "",
            "required": true,
            "visibleRule": "outputTarget = Wiki",
            "helpMarkDown": "Wiki to store the generated markdown file"
        },
        {
            "name": "targetWikiPath",
            "type": "string",
            "label": "Wiki page path",
            "defaultValue": "",
            "required": true,
            "visibleRule": "outputTarget = Wiki",
            "helpMarkDown": "Path to Wiki page to write rendered notes to"
        }
    ],

    "dataSourceBindings": [
        {
            "target": "notes",
            "endpointId": "$(connection)",
            "dataSourceName": "Bravo Notes",
            "resultTemplate":
                "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{title}}}\" }"
        },
        {
            "target": "targetWiki",
            "endpointId": "tfs:teamfoundation",
            "endpointUrl":
                "{{endpoint.url}}/{{system.teamProject}}/_apis/wiki/wikis?api-version=4.1-preview",
            "resultSelector": "jsonpath:$.value[*]",
            "resultTemplate":
                "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
        }
    ],

    "execution": {
        "Node": {
            "target": "run.js",
            "argumentFormat": ""
        }
    }
}
