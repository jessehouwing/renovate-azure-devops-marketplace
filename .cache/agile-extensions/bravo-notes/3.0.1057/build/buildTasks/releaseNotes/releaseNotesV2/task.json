{
    "id": "665e300e-f163-48a6-aa33-589213df991c",
    "name": "releaseNotes",
    "friendlyName": "Bravo Notes - Compile release notes",
    "description": "Bravo Notes - Compile release notes. Generate release notes as Markdown, HTML or PDF documents.",
    "author": "Agile Extensions",
    "category": "Utility",
    "visibility": ["Build", "Release"],
    "version": {
        "Major": 2,
        "Minor": 31,
        "Patch": 0
    },
    "minimumAgentVersion": "1.82.0",
    "instanceNameFormat": "Release Notes",
    "groups": [
        {
            "name": "advanced",
            "displayName": "Advanced",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "notes",
            "type": "pickList",
            "label": "Notes",
            "defaultValue": "",
            "required": true,
            "properties": {
                "EditableOptions": "True"
            },
            "helpMarkDown": "Bravo Notes document"
        },
        {
            "name": "workItemSource",
            "type": "pickList",
            "label": "Work item source",
            "defaultValue": "Associated",
            "required": true,
            "options": {
                "Associated": "Associated Work Items",
                "Query": "Query"
            },
            "helpMarkDown": "Specify what work items should be pulled into the template. Associated Work Items = Work Items associated with the current build or the current release. The latter only pulls in Work Items associated since the last successful deployment of the current environment."
        },
        {
            "name": "queryId",
            "type": "querycontrol",
            "label": "Query",
            "defaultValue": "",
            "required": "true",
            "helpMarkDown": "Select a saved Work Item query to execute.",
            "visibleRule": "workItemSource = Query"
        },
        {
            "name": "outputFormat",
            "type": "pickList",
            "label": "Output format",
            "defaultValue": "Markdown",
            "required": true,
            "options": {
                "md": "Markdown",
                "html": "HTML",
                "pdf": "PDF"
            },
            "helpMarkDown": "Format of the rendered document"
        },
        {
            "name": "outputTarget",
            "type": "pickList",
            "label": "Output target",
            "defaultValue": "File",
            "required": true,
            "options": {
                "File": "File",
                "Wiki": "Wiki"
            },
            "helpMarkDown": "Target to store the rendered document"
        },
        {
            "name": "outputFilePath",
            "type": "filePath",
            "label": "Output file path",
            "defaultValue": "",
            "required": true,
            "visibleRule": "outputTarget = File",
            "helpMarkDown": "Path to write rendered notes to e.g. releasenotes.pdf"
        },
        {
            "name": "targetWiki",
            "type": "pickList",
            "label": "Target Wiki",
            "defaultValue": "",
            "required": true,
            "visibleRule": "outputTarget = Wiki",
            "helpMarkDown": "Wiki to store the generated markdown file"
        },
        {
            "name": "targetWikiPath",
            "type": "string",
            "label": "Wiki page path",
            "defaultValue": "",
            "required": true,
            "visibleRule": "outputTarget = Wiki",
            "helpMarkDown": "Path to Wiki page to write rendered notes to"
        },
        {
            "name": "extensionId",
            "type": "string",
            "label": "Extension ID",
            "defaultValue": "bravo-notes",
            "required": true,
            "visibleRule": "workItemSource = NEVER",
            "helpMarkDown": "This is just a workarround to pass the extensionId to the task"
        }
    ],

    "dataSourceBindings": [
        {
            "target": "notes",
            "endpointId": "tfs:ems",
            "endpointUrl": "{{endpoint.url}}/_apis/ExtensionManagement/InstalledExtensions/agile-extensions/bravo-notes/Data/Scopes/Default/Current/Collections/rn-index/Documents",
            "resultSelector": "jsonpath:$.value[*]",
            "resultTemplate": "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{title}}}\" }"
        },
        {
            "target": "targetWiki",
            "endpointId": "tfs:teamfoundation",
            "endpointUrl": "{{endpoint.url}}/{{system.teamProject}}/_apis/wiki/wikis?api-version=4.1-preview",
            "resultSelector": "jsonpath:$.value[*]",
            "resultTemplate": "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
        }
    ],

    "execution": {
        "Node": {
            "target": "run.js",
            "argumentFormat": ""
        }
    }
}
